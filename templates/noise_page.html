{% extends "base.html" %}

{% block title %}{{ noise.title }} - Каталог Шумов{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/noise-page.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/github.min.css">
{% endblock %}

{% block content %}
<div class="noise-page">
    <section class="noise-header">
        <h1>{{ noise.title }}</h1>
        <div class="noise-tags">
            {% for tag in noise.tags %}
            <span class="tag">{{ tag }}</span>
            {% endfor %}
        </div>
        <p class="noise-description">{{ noise.description }}</p>
    </section>

    <section class="interactive-demo">
        <h2>Интерактивная демонстрация</h2>
        <div class="interactive-container">
            <div class="image-container">
                <div class="original-image">
                    <h3>Исходное изображение</h3>
                    <img id="original" src="{{ url_for('static', filename='images/test-images/test_image.png') }}" alt="Тестовое изображение">
                </div>
                <div class="noisy-image">
                    <h3>С шумом {{ noise.title }}</h3>
                    <canvas id="noisy-canvas" width="256" height="256"></canvas>
                </div>
                <div class="noise-pattern">
                    <h3>Шумовой паттерн</h3>
                    <canvas id="noise-canvas" width="256" height="256"></canvas>
                </div>
            </div>
            
            <div class="controls">
                {% for param in noise.parameters %}
                <div class="slider-container">
                    <label for="{{ param.name }}-slider">{{ param.symbol }} ({{ param.name }}): <span id="{{ param.name }}-value">{{ param.default }}</span></label>
                    <input type="range" id="{{ param.name }}-slider" min="{{ param.min }}" max="{{ param.max }}" value="{{ param.default }}" step="1">
                </div>
                {% endfor %}
                
                <div class="slider-container">
                    <label for="intensity-slider">Интенсивность: <span id="intensity-value">100</span>%</label>
                    <input type="range" id="intensity-slider" min="0" max="200" value="100" step="1">
                </div>
                
                <button id="regenerate-btn">Сгенерировать заново</button>
                <button id="download-btn">Скачать изображение</button>
            </div>
            
            <div class="visualization-container">
                <div class="distribution-plot">
                    <h3>Распределение шума</h3>
                    <div id="histogram-plot"></div>
                </div>
                <div class="spectrum-plot">
                    <h3>Частотный спектр</h3>
                    <div id="spectrum-plot"></div>
                </div>
            </div>
        </div>
    </section>

    <section class="mathematical-description">
        <h2>Математическое описание</h2>
        <div class="formula-container">
            <h3>Распределение</h3>
            <div class="formula">
                <p>{{ noise.distribution_description }}</p>
                <div class="math-formula">
                    {{ noise.formulas.distribution }}
                </div>
                {% if noise.parameters|length > 0 %}
                <p>где:</p>
                <ul>
                    {% for param in noise.parameters %}
                    <li>\({{ param.symbol }}\) - {{ param.description }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            
            <h3>Модель шума</h3>
            <div class="formula">
                <p>Зашумленное изображение \(g(x,y)\) получается из исходного изображения \(f(x,y)\) как:</p>
                <div class="math-formula">
                    {{ noise.formulas.noise_model }}
                </div>
                {% if noise.formulas.constraints %}
                <p>где {{ noise.formulas.constraints }}</p>
                {% endif %}
            </div>
            
            <h3>Свойства</h3>
            <div class="properties">
                <ul>
                    {% for property in noise.properties %}
                    <li><strong>{{ property.name }}:</strong> {{ property.description }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </section>
    
    <section class="occurrence">
        <h2>Встречаемость в реальном мире</h2>
        <div class="occurrence-content">
            <ul>
                {% for occurrence in noise.occurrences %}
                <li><strong>{{ occurrence.context }}:</strong> {{ occurrence.description }}</li>
                {% endfor %}
            </ul>
        </div>
    </section>

    <section class="code-implementation">
        <h2>Реализация в коде</h2>
        <div class="code-tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="python">Python</button>
                <button class="tab-btn" data-tab="javascript">JavaScript</button>
                <button class="tab-btn" data-tab="matlab">MATLAB</button>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="python-code">
                    <pre><code class="language-python">{{ noise.code.python }}</code></pre>
                </div>
                <div class="tab-pane" id="javascript-code">
                    <pre><code class="language-javascript">{{ noise.code.javascript }}</code></pre>
                </div>
                <div class="tab-pane" id="matlab-code">
                    <pre><code class="language-matlab">{{ noise.code.matlab }}</code></pre>
                </div>
            </div>
        </div>
    </section>

    <section class="related-noise-types">
        <h2>Связанные типы шумов</h2>
        <div class="related-grid">
            {% for related_id in noise.related_noise_types %}
            {% set related = noise_catalog[related_id] %}
            <a href="{{ url_for('noise_page', noise_id=related_id) }}" class="related-card">
                <img src="{{ url_for('static', filename='images/thumbnails/' + related_id + '.png') }}" alt="{{ related.title }}">
                <h3>{{ related.title }}</h3>
                <p>{{ related.short_description }}</p>
            </a>
            {% endfor %}
        </div>
    </section>

    <section class="references">
        <h2>Ссылки и литература</h2>
        <ul class="reference-list">
            {% for ref in noise.references %}
            <li>
                {{ ref.authors }} ({{ ref.year }}). {{ ref.title }}. 
                {% if ref.publisher %}{{ ref.publisher }}.{% endif %}
                {% if ref.edition %}{{ ref.edition }}{% endif %}
            </li>
            {% endfor %}
        </ul>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
<script src="{{ url_for('static', filename='js/noise-generator.js') }}"></script>
<script src="{{ url_for('static', filename='js/visualizations.js') }}"></script>
<script src="{{ url_for('static', filename='js/' + noise.id + '-demo.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Render math formulas
        renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ]
        });
        
        // Setup code syntax highlighting
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
        });
        
        // Setup tabs
        setupTabs();
    });
</script>
{% endblock %}